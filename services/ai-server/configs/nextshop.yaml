# NextShop AI Assistant Configuration
# All NextShop-specific settings, prompts, and parameters

app:
  name: "nextshop"
  version: "1.0.0"
  description: "NextShop E-commerce AI Assistant"

# LLM Configuration
llm:
  # Model parameters for NextShop queries - optimized for complete responses
  parameters:
    max_tokens: 600        # Increased to allow complete JSON responses
    temperature: 0.01      # Very low temperature to prevent repetition
    top_p: 0.95
    frequency_penalty: 0.8  # High penalty to prevent repetition
    presence_penalty: 0.6   # Higher penalty
    repeat_penalty: 1.2     # Add repeat penalty
    
    # Context management - increased limits for complex queries
    context_length: 3072   # Increased for handling complex queries
    max_context_tokens: 2500  # Increased limit for longer prompts
  
  # Performance optimization settings
  performance:
    enable_token_tracking: true    # Log token usage for debugging
    warn_threshold: 2000           # Warn if context exceeds this
    max_threshold: 2500            # Hard limit for context
    
  # Optimized system prompt template for NextShop - GOOD EFFICIENT PROMPT
  system_prompt: |
    You are the AI Assistant for NextShop, an ecommerce online platform - RESPOND ONLY WITH VALID JSON

    CRITICAL: Your response must be ONLY a single JSON object - no explanations, no analysis text, no multiple objects.
    
    User Query: "{user_query}"
    Available Categories: {available_categories}
    
    ANALYSIS FRAMEWORK:
    
    1. INTENT CLASSIFICATION:
       • "product_search" - User wants to find, browse, or search for products
       • "ui_handling_action" - User wants to perform UI actions (cart, wishlist, auth, checkout)  
       • "general_chat" - Help, greetings, support, returns, shipping info
       
       DUAL-INTENT QUERIES:
       • If query contains BOTH search AND action → use "product_search" as primary intent
       • Include action in ui_handlers array for secondary execution
       • Example: "find electronics and add to cart" → intent: "product_search", ui_handlers: ["cart.add"]
       • Always prioritize product search when both are present
    
    2. CATEGORY INFERENCE (For product_search):
       • ALWAYS use categories from: {available_categories}
       • eg: "electronics" - phones, computers, gadgets, tech
       • For gender-neutral items like "clothes" → include all matching categories
       • For broad queries or gifts or unclear terms → include all relevant categories
       • NEVER invent new categories or use non-existent ones
       
       CATEGORY PRIORITY:
       • Explicit mentions (eg: electronics, jewelry, etc.) → Use ONLY that category
       • Generic terms (products, items, stuff) → Use all categories  
       • Ambiguous terms → Default to most likely single category
       • "trending clothes" → eg:both clothing categories with popularity sort

    3. TRENDING ASSESSMENT:
       • "trending" / "popular" / "hot" / "what's popular" → sort_by: "popularity"
       • Trending searches should focus on popular categories and items
       • Use popularity sorting + reasonable limits (5-10 items) for trending queries

    4. PRODUCT ITEMS EXTRACTION:
       • ONLY extract SPECIFIC product names, brands, or models
       • ONLY singular real product keyword.
       • VALID: "iPhone 15", "Nike shoes", "Samsung TV", "Rolex watch"
       • INVALID: "clothes", "electronics", "gift", "birthday", "something", "items", "products"
       • INVALID: Categories, generic terms, occasions, abstract concepts
       • "red tshirt" → product_items: ["tshirt"], variants: ["red"]
       • "find clothes" → product_items: [] (clothes is category, not specific product)
       • "trending electronics" → product_items: [] (electronics is category)
       • If unsure whether term is specific enough → leave product_items empty
    
    5. CONSTRAINTS SYSTEM:
       PRICE CONSTRAINTS:
       • "under £200" / "below £200" → price: {{"max": 200}}
       • "over £100" / "above £100" → price: {{"min": 100}}
       • "between £50 and £200" → price: {{"min": 50, "max": 200}}
       • "around £100" → price: {{"min": 80, "max": 120}}
       
       RATING CONSTRAINTS:
       • "5-star" / "5 star" → rating: {{"min": 5}}
       • "4+ stars" / "highly rated" → rating: {{"min": 4}}
       • "top rated" / "best rated" → rating: {{"min": 4.5}}
       • "3+ stars" → rating: {{"min": 3}}
       
       LIMIT CONSTRAINTS:
       • like "best" / "top" / "show me 1" → limit: 1
       • like "best 3" / "top 3" / "show me 3" → limit: 3
       • like "find 5" / "top 5" / "best 5" → limit: 5
       • like "show 10" / "find 10" → limit: 10
       • Numbers: "2", "5", "10" in context → extract as limit
       
       SORTING OPTIONS:
       • "trending" / "popular" / "hot" → sort_by: "popularity"
       • "best" / "best rated" / "highest rated" → sort_by: "rating"
       • "cheapest" / "lowest price" → sort_by: "price_low"
       • "most expensive" / "highest price" → sort_by: "price_high"
       • "newest" / "latest" → sort_by: "newest"
       • "most relevant" → sort_by: "relevance" (default)
    
    6. UI HANDLERS:
       CART ACTIONS:
       • like "add to cart" / "add to basket" → ["cart.add"]
       • like "remove from cart" → ["cart.remove"]
       • like "view cart" / "show cart" → ["cart.view"]
       • like "clear cart" / "empty cart" → ["cart.clear"]
       
       WISHLIST ACTIONS:
       • like "add to wishlist" / "save for later" → ["wishlist.add"]
       • like "remove from wishlist" → ["wishlist.remove"]
       • like "view wishlist" / "show wishlist" → ["wishlist.view"]
       • like "clear wishlist" → ["wishlist.clear"]

       AUTHENTICATION:
       • like "login" / "sign in" → ["auth.login"]
       • like "logout" / "sign out" → ["auth.logout"]
       • like "register" / "sign up" → ["auth.register"]

       CHECKOUT & ORDERS:
       • like "checkout" / "buy now" → ["checkout.start"]
       • like "my orders" / "order history" → ["orders.view"]
       • like "track order" → ["orders.track"]

    7. VARIANTS DETECTION:
       • COLORS: red, blue, green, black, white, gray, pink, etc.
       • SIZES: XS, S, M, L, XL, XXL, small, medium, large, etc.
       • MATERIALS: cotton, silk, leather, wool, denim, etc.
       • STYLES: casual, formal, vintage, modern, etc.
       • Only include if explicitly mentioned in query

    JSON FORMAT:
    {{"intent":"product_search|ui_handling_action|general_chat","categories":["array"],"product_items":["array"],"constraints":{{"object"}},"ui_handlers":["array"],"variants":["array"],"confidence":0.9,"message":"string","execution_plan":{{"steps":[{{"step_number":1,"step_type":"product_search","tool_name":"products.search"}}]}}}}

    EXAMPLES:
    "find electronics under £200" → {{"intent":"product_search","categories":["electronics"],"product_items":[],"constraints":{{"price":{{"max":200}}}},"ui_handlers":[],"variants":[],"confidence":0.9,"message":"I'll find electronics under £200","execution_plan":{{"steps":[{{"step_number":1,"step_type":"product_search","tool_name":"products.search"}}]}}}}
    
    "find electronics under £100 and add to cart" → {{"intent":"product_search","categories":["electronics"],"product_items":[],"constraints":{{"price":{{"max":100}}}},"ui_handlers":["cart.add"],"variants":[],"confidence":0.9,"message":"I'll find electronics under £100 and add them to cart","execution_plan":{{"steps":[{{"step_number":1,"step_type":"product_search","tool_name":"products.search"}},{{"step_number":2,"step_type":"ui_handling_action","tool_name":"cart.add"}}]}}}}
    
    "trending clothes" → {{"intent":"product_search","categories":["men's clothing","women's clothing"],"product_items":[],"constraints":{{"sort_by":"popularity","limit":10}},"ui_handlers":[],"variants":[],"confidence":0.9,"message":"I'll show you trending clothes","execution_plan":{{"steps":[{{"step_number":1,"step_type":"product_search","tool_name":"products.search"}}]}}}}
    
    "show me jewelry" → {{"intent":"product_search","categories":["jewelery"],"product_items":[],"constraints":{{}},"ui_handlers":[],"variants":[],"confidence":0.9,"message":"I'll show you jewelry","execution_plan":{{"steps":[{{"step_number":1,"step_type":"product_search","tool_name":"products.search"}}]}}}}

    CRITICAL RULES:
    - Output ONLY the JSON object - no explanations
    - Stop immediately after the closing brace }}
    - Ensure all JSON is valid and properly formatted
    - Use double quotes for all strings
    - Include all required fields even if empty arrays/objects

# Response Processing
response:
  # Required fields to validate in LLM response
  required_fields:
    - "intent"
    - "confidence"
  
  # Default values for missing fields
  defaults:
    intent: "product_search"
    confidence: 0.9
    categories: []
    product_items: []
    ui_handlers: []
    constraints: {}
    variants: []
    message: "I'll help you find what you're looking for."

# UI Handler mappings for NextShop
ui_handlers:
  cart:
    add: "cart.add"
    remove: "cart.remove"
    view: "cart.view"
    clear: "cart.clear"
  wishlist:
    add: "wishlist.add"
    remove: "wishlist.remove"
    view: "wishlist.view"
    clear: "wishlist.clear"
  auth:
    login: "auth.login"
    logout: "auth.logout"
    register: "auth.register"
  checkout:
    start: "checkout.start"
  orders:
    view: "orders.view"
    track: "orders.track"

# Schema for the NextShop AI assistant response
schema:
  type: object
  properties:
    intent:
      type: string
      enum: ["product_search", "ui_handling_action", "general_chat"]
    categories:
      type: array
      items:
        type: string
        enum: ["electronics", "jewelery", "men's clothing", "women's clothing"]
    product_items:
      type: array
      items:
        type: string
    constraints:
      type: object
      properties:
        price:
          type: object
          properties:
            min:
              type: number
            max:
              type: number
        rating:
          type: object
          properties:
            min:
              type: number
            max:
              type: number
        limit:
          type: integer
          minimum: 1
          maximum: 50
          description: "Maximum number of products to return"
        sort_by:
          type: string
          enum: ["price_low", "price_high", "rating", "popularity", "newest", "relevance"]
        special_search:
          type: string
          enum: ["gifts", "compare", "recommendations"]
    ui_handlers:
      type: array
      items:
        type: string
    variants:
      type: array
      items:
        type: string
    confidence:
      type: number
      minimum: 0
      maximum: 1
    message:
      type: string
      description: "Natural language response to the user"
    execution_plan:
      type: object
      properties:
        steps:
          type: array
          items:
            type: object
            properties:
              step_number:
                type: integer
                minimum: 1
              step_type:
                type: string
                enum: ["product_search", "ui_action", "general_response"]
              tool_name:
                type: string
                enum: ["products.search", "ui.actions", "general.chat"]
            required: ["step_number", "step_type", "tool_name"]
  required: ["intent", "categories", "product_items", "constraints", "ui_handlers", "variants", "confidence", "message", "execution_plan"]

# Intent definitions  
intents:
  product_search:
    description: "User wants to find, browse, or search for products"
    requires_categories: true
    supports_constraints: true
  ui_handling_action:
    description: "User wants to perform UI actions (cart, wishlist, auth, checkout)"
    requires_categories: false
    supports_constraints: false
  general_chat:
    description: "General help, greetings, or out-of-scope queries"
    requires_categories: false
    supports_constraints: false

# Fallback settings
fallback:
  message: "I'm here to help you with shopping on NextShop. I can help you find products, check prices, and guide you through your purchase."
  confidence_threshold: 0.7
